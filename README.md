# Тестовое задание

## Функционал

#### 1. CRUD (подсказка: DRF) Новостей с данными:

- Заголовок новости
- Главное изображение
- Превью-изображение (автоматически генерировать из главного изображения путём уменьшения до 200px по наименьшей стороне)
- Текст новости
- Дата публикации
- Автор новости

Реализован API для создания, удаления, обновления и получения Новостей с помощью Django Rest Framework.

#### 2. Просмотр и редактирование Новостей с rich-текстом (подсказка: summernote) в админке.

Реализована административная модель **_Новости_** для админ-панели, позволяющая просматривать и редактировать текст **_Новости_** с rich-текстом с использованием редактора Summernote.

Поле доступно при редактировании объектов модели **_Новость_** в админ-панели.

#### 3. Выполнение периодической задачи (подсказка: celery) на отправку email о Новостях, опубликованных сегодня, с настройками (подсказка: constance):

- Список адресатов
- Тема сообщения
- Текст сообщения
- Время отправки

Создана задача **send_email()** для отправки **_Новостей_** в определённое время, заданное параметрами EMAIL_SEND_TIME (редактируются в админ-панели в разделе настроек Constance).

#### 4. Импорт Примечательных мест из xlsx-файла с данными:

- Название места
- Гео-координаты места (точка)
- Рейтинг (от 0 до 25)

Импорт **_Примечательных мест_** из xlsx-файла реализован в виде кнопки "Импорт" на странице change\*list объектов модели \*\*\*Примечательного места\_\*\* в админ-панели.

При нажатии на кнопку и выборе xlsx-файла происходит вызов функции **_import_sights()_**, реализующей разбор файла с помощью библиотеки openpyxl и создание объектов Sight.

Формат файла – 4 столбца (Название места, широта, долгота, рейтинг).

Строки, соответствующие форматам данных и валидационным ограничениям модели **_Примечательного мечта_** будут загружены, остальные проигнорированы.

#### 5. Просмотр и редактирование Примечательных мест в админке, координаты получать с помощью виджета карты.

Редактирование примечательных мест в админ-панели реализовано с помощью виджета Яндекс-карт.

Для его использования необходимо заполнить переменную API_KEY в файле .env действующим токеном.

Изначально на виджете отображается место исходя из прочитанных из файла координат, при передвижении указателя координаты будут меняться.

Для подключения карты был реализован виджет **_MapWidget_** для модели Примечательных мест в админ-панели, обеспечивающий взаимодействие между полями координат и картой с помощью JavaScript.

#### 6. Выполнение периодической задачи (подсказка: celery) на получение(Не выполнено) Сводки погоды в Примечательном месте:

- Периодичность выполнения задачи должна редактироваться из админки, по умолчанию - раз в час
- Провайдера погоды выбрать самостоятельно (можно реализовать сервис в другом приложении)
- Данные Сводки погоды:
  - Температура по шкале Цельсия
  - Влажность воздуха, в %
  - Атмосферное давление, в мм ртутного столба
  - Направление ветра
  - Скорость ветра, в м/с
- Данные Сводки погоды должны быть реалистичными и разными (но не обязательно настоящими)
- Данные Сводки погоды должны сохраняться без возможности редактирования

#### 7. Просмотр Сводки погоды в админке с фильтром по Примечательному месту и дате снятия показаний. (Не выполнено)

Фильтр по дате снятия показаний реализован с помощью функционала date\*hierarchy в административной модели \*\*\*Сводки погоды\_\*\*.

#### 8. Экспорт Сводки погоды в xlsx-файл (подсказка: xlsxWriter) с фильтром по Примечательному месту и дате снятия показаний. (Не выполнено)

---

## Инструкции по запуску

Перед запуском приложения необходимо заполнить файл с переменными окружения (.env) и поместить его в директорию app/core:

    EMAIL_HOST – SMTP-сервер провайдера почты
    EMAIL_PORT – порт почтового сервера
    EMAIL_HOST_USER – имя пользователя на почтовом сервере
    EMAIL_HOST_PASSWORD – пароль пользователя на почтовом сервере
    API_KEY – ключ Yandex Maps API
    WEATHER_API_KEY – Ключ Yandex Weather API

### Локальное развёртывание

Пример установки для Windows:

После успешной установки и запуска RabbitMQ в корне проекта создать и активировать виртуальное окружение, установить зависимости проекта:

`python -m venv venv`

`. venv/Script/activate`

`pip install -r app/requirements.txt`

Перейти в директорию app/core и выполнить миграции:

`cd app/core`

`py manage.py migrate`

После успешного выполнения миграций можно создать суперпользователя и запустить приложение:

`py manage.py createsuperuser`

`py manage.py runserver`

Рабочий процесс и планировщик Celery также необходимо запускать, находясь в активированном виртуальном окружении и в директории app/core:

`celery -A core worker --loglevel=info`

`celery -A core beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler`

### Развёртывание в Docker

Собрать контейнеры:

`docker-compose up -d --build`

Применить миграции и создать суперпользователя в контейнере web:

`docker exec -it <container_id> bash`

`cd core`

`py manage.py migrate`

`py manage.py createsuperuser`

Перезагрузить контейнеры.

Админ-панель приложения будет доступна по адресу http://localhost:8000/admin/
